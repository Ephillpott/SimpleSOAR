#!/bin/bash

# Quarantine directory
QUARANTINE_DIR="/path/to/quarantine" # Replace with your quarantine directory

# Directory to monitor for potentially malicious files
MONITOR_DIR="/path/to/monitor" # Replace with the directory you want to monitor

# Log file for quarantined files
QUARANTINE_LOG="/var/log/quarantined_files.log"

# Quarantine Function
quarantine_file() {
  FILE_PATH=$1

  # Calculate SHA-256 hash of the file
  FILE_HASH=$(sha256sum "$FILE_PATH" | awk '{print $1}')

  # Move the file to the quarantine directory
  mv "$FILE_PATH" "$QUARANTINE_DIR"

  # Change file permissions to remove execute and write permissions for all users
  chmod a-wx "$QUARANTINE_DIR/$FILE"

  # Log the quarantine event
  echo "$(date) - Quarantined file: $FILE_PATH, Hash: $FILE_HASH" >> $QUARANTINE_LOG

  echo "Quarantined and neutralized file: $FILE_PATH"
}


# Monitor the directory for new files
inotifywait -m -r -e create "$MONITOR_DIR" | while read PATH ACTION FILE; do
  FILE_PATH="$PATH/$FILE"

  # Scan the file with ClamAV
  clamscan "$FILE_PATH"

  # Check the exit code of clamscan
  if [ $? -ne 0 ]; then
    quarantine_file "$FILE_PATH"
  fi
done
